name: GitHub Actions Deploy On Vps
run-name: ${{ github.actor }} deploy on VPS ðŸš€
on: [push]

jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Golang
        uses: actions/setup-go@v5
        with:
          go-version: "1.23"
          check-latest: true
      - run: go version
      - name: Install Golang Dependencies
        run: go mod download
      - name: Build Golang App
        run: GOOS=lunix go build -o build/difus -v
      - name: Display Build Golang App
        run: ls -R build/
      - name: Create Env File
        run: cat build/.env
      - name: Run Unit Test Golang App
        run: go test
      - name: Copy Build Golang App
        uses: appleboy/scp-action@master
        with:
          host: "${{ secrets.VM_HOST }}"
          username: "${{ secrets.VM_USERNAME }}"
          key: "${{ secrets.VM_SSH_KEY }}"
          port: "${{ secrets.VM_SSH_PORT }}"
          source: build/
          target: /var/www/difus
      # - name: Deploy Build Golang App To Debian VM
      #   uses: appleboy/scp-action@master
      #   with:
      #     host: "${{ secrets.VM_HOST }}"
      #     username: "${{ secrets.VM_USERNAME }}"
      #     key: "${{ secrets.VM_SSH_KEY }}"
      #     port: "${{ secrets.VM_SSH_PORT }}"
      #     script: |
      #       cd /var/www/GoApplications/build
      #       ls -l
      #       sudo systemctl reload nginx
      #       sudo systemctl status nginx
